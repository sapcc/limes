<!--
SPDX-FileCopyrightText: 2025 SAP SE or an SAP affiliate company

SPDX-License-Identifier: Apache-2.0
-->

# List of metrics

Both the API service and the collector service expose all metrics generated by the standard Go client for Prometheus,
e.g. `go_memstats_alloc_bytes` for memory usage or `go_goroutines` for goroutine count.

## API service

The API service exposes the standard HTTP metrics generated by the standard Go client for Prometheus:

| Type | Metric | Labels |
| --- | --- | --- |
| Summary | `http_request_duration_microseconds` |
| Summary | `http_request_size_bytes` |
| Counter | `http_requests_total` | `code`, `method` |
| Summary | `http_response_size_bytes` |

## Collector service

The collector service exposes the following metrics by default:

| Type | Metric | Labels |
| --- | --- | --- |
| Counter | `limes_successful_scrapes` | `service`, `service_name` (counts projects) |
| Counter | `limes_failed_scrapes` | `service`, `service_name` (counts projects) |
| Counter | `limes_successful_domain_discoveries` | none |
| Counter | `limes_failed_domain_discoveries` | none |
| Counter | `limes_successful_project_discoveries` | `domain`, `domain_id` |
| Counter | `limes_failed_project_discoveries` | `domain`, `domain_id` |
| Counter | `limes_successful_capacity_scrapes` | `service_type` |
| Counter | `limes_failed_capacity_scrapes` | `service_type` |
| Counter | `limes_successful_auditevent_publish` | none |
| Counter | `limes_failed_auditevent_publish` | none |

The `limes_failed_scrapes` metric is particularly useful for assessing the continued operation of backend services
(specifically their API parts). If you can do only one alert on Limes metrics, alert on `limes_failed_scrapes`.
Alerts on `limes_failed_{domain,project}_discoveries` are very useful, too, but less important.

For the scraping metrics, the `service` label contains the type of the backend service in question (as stated in the Keystone
service catalog), and the `service_name` label contains the product name (in lower case) of the reference implementation
of this service, for instance, `service_name="nova"` for `service="compute"`.

## Data metrics

With the configuration option `collector.data_metrics` set to true, the collector service will report the following
additional metrics:

| Type | Metric | Labels |
| --- | --- | --- |
| Gauge | `limes_autogrow_growth_multiplier` | `service`, `resource` |
| Gauge | `limes_autogrow_quota_overcommit_threshold_percent` | `service`, `resource` |
| Gauge | `limes_available_commitment_duration` | `service`, `resource` |
| Gauge | `limes_cluster_capacity` | `service`, `resource` |
| Gauge | `limes_cluster_capacity_per_az` | `service`, `resource`, `availabilityZone` |
| Gauge | `limes_cluster_usage_per_az` | `service`, `resource`, `availabilityZone` |
| Gauge | `limes_domain_quota` | `service`, `resource`, `domain`, `domain_id` |
| Gauge | `limes_project_backendquota` | `service`, `resource`, `domain`, `domain_id`, `project`, `project_id` |
| Gauge | `limes_project_commitment_min_expires_at` | `service`, `resource`, `domain`, `domain_id`, `project`, `project_id` |
| Gauge | `limes_project_committed_per_az` | `service`, `resource`, `domain`, `domain_id`, `project`, `project_id`, `availabilityZone`, `state` |
| Gauge | `limes_project_override_quota_from_config` | `service`, `resource`, `domain`, `domain_id`, `project`, `project_id` |
| Gauge | `limes_project_physical_usage` | `service`, `resource`, `domain`, `domain_id`, `project`, `project_id` |
| Gauge | `limes_project_quota` | `service`, `resource`, `domain`, `domain_id`, `project`, `project_id`, |
| Gauge | `limes_project_rate_usage` | `service`, `rate`, `domain`, `domain_id`, `project`, `project_id` |
| Gauge | `limes_project_usage` | `service`, `resource`, `domain`, `domain_id`, `project`, `project_id` |
| Gauge | `limes_project_usage_per_az` | `service`, `resource`, `domain`, `domain_id`, `project`, `project_id`, `availabilityZone` |
| Gauge | `limes_project_used_and_or_committed_per_az` | `service`, `resource`, `domain`, `domain_id`, `project`, `project_id`, `availabilityZone` |
| Gauge | `limes_unit_multiplier` | `service`, `resource` |

### Quota/capacity collection metrics

Quota and capacity querying is done by liquids. The collection processes for them can emit metrics.

| Type | Metric | Labels |
| --- | --- | --- |
| Gauge | `limes_capacity_collection_metrics_ok` | `service_type` |
| Gauge | `limes_usage_collection_metrics_ok` | `domain`, `domain_id`, `project`, `project_id`, `service`, `service_name` |
